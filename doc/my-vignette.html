<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>ASAP-vignette</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">ASAP-vignette</h1>



<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ASAP)</code></pre></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>ASAP is an R package that leverages PCA and NNLS (Non-Negative Least Squares) to assess the ancestral composition of admixed individuals with high accuracy and reliability, the approach further described in &quot;ASAP - Assessing Ancestry through Principal Components&quot; De Gennaro &amp; Molinaro et al, Journal, Year, doi. ASAP assigns the genetic ancestry of list of target samples or populations given a list of putative sources.</p>
<p>ASAP estimations are based on a PCA where the targets and sources group are available, along with those we suggest to use additional groups to better define the PC space. Once that the PC space is defined, a set of NNLS is then applied on the PC coordinates, effectively summarizing the genetic ancestry.</p>
<p>For its most basic usage ASAP needs:</p>
<ol style="list-style-type: upper-roman">
<li>A PCA matrix, a dataframe with N PCs<br />
</li>
<li>A list of target and source groups (or samples)</li>
</ol>
</div>
<div id="basic-usage-example" class="section level1">
<h1>Basic usage example</h1>
<p>Right below you can find a very basic way to run ASAP, if you want more details, please keep on reading.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>pca =<span class="st"> </span><span class="kw">read_eigen</span>(<span class="dt">pca_input =</span> <span class="st">'data/TOY.pca.evec'</span>)
<span class="op">$</span><span class="st"> </span>ASAP_result =<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca, <span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">'ESN'</span>,<span class="st">'CEU'</span>), <span class="dt">admixed=</span><span class="kw">c</span>(<span class="st">'GIH'</span>))</code></pre></div>
<p>ASAP package has two functions to read the PCA matrix, <code>read_eigen()</code> and <code>read_flash()</code>.<br />
* <code>read_eigen()</code> will read a PCA that has been created with smartpca from the EIGENSOFT software.<br />
* <code>read_flash()</code> instead, will read a PCA that has been created with flashpca software.<br />
The goal of both functions is to set the PCA file so that it looks as follows:</p>
<table>
<thead>
<tr class="header">
<th>POP</th>
<th align="left">IND</th>
<th align="left">PCN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ASW</td>
<td align="left">ASW_1</td>
<td align="left">0.01</td>
</tr>
<tr class="even">
<td>ASW</td>
<td align="left">ASW_2</td>
<td align="left">0.02</td>
</tr>
<tr class="odd">
<td>BEB</td>
<td align="left">BEB_1</td>
<td align="left">0.08</td>
</tr>
</tbody>
</table>
<p>If neither <code>read_eigen()</code> nor <code>read_flash()</code> is for you, you might want to simply use <code>read.table()</code>, and set the file so that it has the aforementioned look.</p>
<p>For the sake of the example, let's say you obtained a PCA from the software EIGENSOFT, using smartpca.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>pca =<span class="st"> </span><span class="kw">read_eigen</span>(<span class="dt">pca_input =</span> <span class="st">'data/TOY.pca.evec'</span>)</code></pre></div>
<p>The second step is to set up an 'AS_file', a file with the list of the Admixed groups (A) and the Source groups (S). If you want to use ASAP sample-wise rather than group-wise, simply adjust the PCA file so that in the 'POP' column is identical to the 'IND' column, and set the AS_file with the samples list, rather than the group list.<br />
The AS_file is a two-columns file with the population list on the first column, and the 'A/S' information on the second column. The 'A/S' information stands for Admixed (A) or Source (S), for each population/group we will indicate whether ASAP should consider it as a Source (S) or as an admixed target (A), the file looks like this:</p>
<table>
<thead>
<tr class="header">
<th>POP</th>
<th>A/S</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESN</td>
<td>S</td>
</tr>
<tr class="even">
<td>CEU</td>
<td>S</td>
</tr>
<tr class="odd">
<td>GIH</td>
<td>A</td>
</tr>
</tbody>
</table>
<p>To read the AS_file, a simple <code>read_table(file, header=T)</code> will be sufficient.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>AS_file =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">'data/Example_AS_eigen'</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>With the PCA and AS_file loaded, we are finally ready to run ASAP as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>ASAP_result =<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca, <span class="dt">as_file =</span> AS_file)</code></pre></div>
<p>You can avoid relying on the AS_file if you wish, and rather use a vector of the target and source groups directly in ASAP() function, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>ASAP_result =<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca, <span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">'ESN'</span>,<span class="st">'CEU'</span>), <span class="dt">admixed=</span><span class="kw">c</span>(<span class="st">'GIH'</span>))</code></pre></div>
<p>Finally, if you want to save ASAP results on a table-like format, you can use <code>write_ASAP()</code>, this way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>ASAP_result &lt;-<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca, <span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">'ESN'</span>,<span class="st">'CEU'</span>), <span class="dt">admixed=</span><span class="kw">c</span>(<span class="st">'GIH'</span>))
<span class="op">$</span><span class="st"> </span><span class="kw">write_ASAP</span>(<span class="dt">ASAP_input =</span> ASAP_result, <span class="dt">output_name =</span> <span class="st">'my_dir/my_asap_results.txt'</span>)</code></pre></div>
</div>
<div id="plotting" class="section level1">
<h1>Plotting</h1>
<p>The function <code>plot_asap()</code> can help you plot <code>ASAP()</code> results. Based on your preferences, you can either rely on basic R or on ggplot2 to plot your results. Let's say we want to plot ASAP results using ggplot2:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>ASAP_result &lt;-<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca, <span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">'ESN'</span>,<span class="st">'CEU'</span>), <span class="dt">admixed=</span><span class="kw">c</span>(<span class="st">'GIH'</span>))
<span class="op">$</span><span class="st"> </span><span class="kw">plot_asap</span>(ASAP_result, <span class="st">'ASAP_plot'</span>, <span class="dt">type_ggplot =</span> <span class="st">'YES'</span>)</code></pre></div>
<p>Alternatively, to plot with basic R, just run the command without <code>type_ggplot</code> option, like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>ASAP_result &lt;-<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca, <span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">'ESN'</span>,<span class="st">'CEU'</span>), <span class="dt">admixed=</span><span class="kw">c</span>(<span class="st">'GIH'</span>))
<span class="op">$</span><span class="st"> </span><span class="kw">plot_asap</span>(ASAP_result, <span class="st">'ASAP_plot'</span>)</code></pre></div>
<p>You will find a barplot in your working directory.</p>
</div>
<div id="selecting-the-optimal-number-of-pcs" class="section level1">
<h1>Selecting the optimal number of PCs</h1>
<p>Applying ASAP on a different number of PCs can indeed impact the tool accuracy, therefore we advice to detect the optimal number of PCs to run ASAP on based on euclidean distances (ED). You can estimate the cumulative ED between <strong>pairs</strong> of sources with the function <code>pcs_distances()</code>.<br />
Once the ED estimations are done, <code>pcs_distances()</code> allows to plot the results, in a scatterplot where the x-axis is informative of the cumulative PCs, the y-axis of the ED values. We want to see with which set of cumulative PCs, the EDs reach a plateau.<br />
We are running <code>pcs_distances()</code> with the following input files and parameters:</p>
<ol style="list-style-type: upper-roman">
<li>a PCA with 100 PCs, so we will have 100 cumulative ED values</li>
<li>A source_file table, a two-columns table with source1 (S1) and source2 (S2), listing the pairs of sources that will be compared. Like follows:</li>
</ol>
<table>
<thead>
<tr class="header">
<th>S1</th>
<th>S2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESN</td>
<td>CEU</td>
</tr>
<tr class="even">
<td>CEU</td>
<td>GIH</td>
</tr>
<tr class="odd">
<td>GIH</td>
<td>ASW</td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: upper-roman">
<li>output_name, a string indicating the output name<br />
</li>
<li>return_plot, set as 'YES' will output the scatterplots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>source_pairs =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">'see_example_in_II'</span>, <span class="dt">header =</span> T)
<span class="op">$</span><span class="st"> </span><span class="kw">pcs_distances</span>(<span class="dt">pca_input =</span> pca, <span class="dt">output_name =</span> <span class="st">'ED_cumuldistances'</span>, <span class="dt">sources_file =</span> source_pairs, <span class="dt">return_plot =</span> <span class="st">'YES'</span>)</code></pre></div>
<p>Following the scatterplot, you can select the number of cumulative PCs in which the ED values start reaching a plateau. Given that we are running <code>pcs_distances()</code> on each source pairs, it is probable that for each pair of sample the number optimal of PCs might be different.<br />
You can run <code>ASAP()</code> on a different number of PCs as below. For example, let's say that for Source1 and Source2, the ED reach a plateau at 23 PCs, we can run <code>ASAP()</code> as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>pc_target &lt;-<span class="st"> </span><span class="kw">c</span>()
<span class="op">$</span><span class="st"> </span><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">23</span>) {pc_target[[i]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;PC&quot;</span>,i)}
<span class="op">$</span><span class="st"> </span>cols_target =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;POP&quot;</span>,<span class="st">&quot;IND&quot;</span>,pc_target)
<span class="op">$</span><span class="st"> </span>ASAP_result &lt;-<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> pca[,cols_target], <span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">'Source1'</span>,<span class="st">'Source2'</span>), <span class="dt">admixed=</span><span class="kw">c</span>(<span class="st">'Admixed1'</span>))</code></pre></div>
</div>
<div id="resampling" class="section level1">
<h1>Resampling</h1>
<p>To produce Standard Errors (SE), you can rely on resampling techniques. Let's say we produce 20 PCAs to estimate the SE, each of them on a dataset with a different SNPs subset: we thus end up with 20 PCAs, all with slighly different values of PC coordinates.<br />
The function <code>read.resampling()</code> reads all 20 PCAs and perform ASAP on each of them, it will return a list containing the results for each resampling (20 ASAP results). Given that <code>read.resampling()</code> will read and perform ASAP on each resampled set, the function uses several arguments:</p>
<ol style="list-style-type: upper-roman">
<li><p>path_tofiles, path to the directory where all the 20 PCAs are stored</p></li>
<li><p>file_pattern, a string containing the name shared by all 20 PCAs, the function will use the string as a pattern to find all files with said string. If this parameter seems confusing, consider that we modelled the function considering that in a resampling setting one could name the PCAs as follows: 'PCA_Resampled_1', 'PCA_Resampled_2',...,'PCA_Resampled_20'. A file_patters as 'PCA_Resampled_' will find all files from 'PCA_Resampled_1' to 'PCA_Resampled_20'.</p></li>
<li><p>as_file, this is the AS_file we used in <code>ASAP()</code>. It is a two-columns file with the population list on the first column, and the 'A/S' information on the second column. The 'A/S' information stands for Admixed (A) or Source (S), for each population/group we will indicate whether ASAP should consider it as a Source (S) or as an admixed target (A), the file looks like this:</p></li>
</ol>
<table>
<thead>
<tr class="header">
<th>POP</th>
<th>A/S</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESN</td>
<td>S</td>
</tr>
<tr class="even">
<td>CEU</td>
<td>S</td>
</tr>
<tr class="odd">
<td>GIH</td>
<td>A</td>
</tr>
</tbody>
</table>
<ol start="4" style="list-style-type: upper-roman">
<li>eigentype, this is an optional argument, if present, PCA will be read through read_eigen() function, if absent PCA will be loaded via <code>read_flash()</code>.</li>
</ol>
<p>All in all, the function can be ran as such:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>AS_file =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">'data/Example_AS_eigen'</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)
<span class="op">$</span><span class="st"> </span>ASAP_resampling =<span class="st"> </span><span class="kw">read.resampling</span>(<span class="dt">path_tofiles =</span> <span class="st">'where/I/stored/my/PCAs/'</span>, <span class="dt">file_pattern =</span> <span class="st">'PCA_Resampled_'</span>, <span class="dt">as_file =</span> AS_file, eigentype)</code></pre></div>
<p>Once you ran ASAP on all 20 of your resampled PCAs, to estimate the SE you can use the <code>se.resampling()</code> function. To do so, you will need your main ASAP results, obtained with <code>ASAP()</code> on the main PCA (the PCA with all the available SNPs), and the ASAP results obtained from the 20 resampled PCAs (with the funtion <code>read.resampling()</code> you can see above).<br />
In the example below, you can see that we first loaded the AS_file through <code>read.table()</code>, the ASAP main results are obtained with <code>ASAP()</code>, the ASAP resampling results are obtained with <code>read.resampling()</code>. Importantly, to ran <code>se.resampling()</code>, you will also need the number of resampled analyses you ran, for this tutorial we ran 20 PCAs, therefore the parameter 'chromovec' is set as 20 (integer).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span><span class="st"> </span>main_pca =<span class="st"> </span><span class="kw">read_eigen</span>(<span class="dt">pca_input =</span> <span class="st">'data/TOY.pca.evec'</span>)
<span class="op">$</span><span class="st"> </span>AS_file =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">'data/Example_AS_eigen'</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)
<span class="op">$</span><span class="st"> </span>ASAP_main_result &lt;-<span class="st"> </span><span class="kw">ASAP</span>(<span class="dt">pca_input =</span> main_pca, <span class="dt">as_file =</span> AS_file)
<span class="op">$</span><span class="st"> </span>ASAP_resampling =<span class="st"> </span><span class="kw">read.resampling</span>(<span class="dt">path_tofiles =</span> <span class="st">'where/I/stored/my/resampled/PCAs/'</span>, <span class="dt">file_pattern =</span> <span class="st">'PCA_Resampling_'</span>, <span class="dt">as_file =</span> AS_file, eigentype)
<span class="op">$</span><span class="st"> </span>chromovec =<span class="st"> </span><span class="dv">20</span> 
<span class="op">$</span><span class="st"> </span>ASAP_SE =<span class="st"> </span><span class="kw">se.resampling</span>(ASAP_main_result, ASAP_resampling, chromovec)</code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
